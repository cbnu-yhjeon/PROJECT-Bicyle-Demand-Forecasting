# 🚲 자전거 대여량 예측 모델 평가 시각화 분석 리포트  
### (Seoul & Washington DC / RandomForest · XGBoost · LightGBM / No-IQR 모델 기준)

---

## ✨ 1. 리포트 개요

이 문서는 **모델 예측 결과 시각화(산점도 & 시계열)**를 기반으로  
서울 및 워싱턴DC 자전거 대여량 예측 모델의 성능을 분석한 종합 리포트입니다.

모델 구조  
- RandomForest (RF)  
- XGBoost (XGB)  
- LightGBM (LGBM)  

데이터 특징  
- IQR 이상치 제거 없음 (no_iqr)  
- Train/Validation/Test 시계열 기반 Split 사용  
- Feature_mode = all  

---

# 🧭 2. 산점도(Actual vs Predicted) 분석

산점도는 **실제 대여량(Actual)** 대비 **모델 예측값(Predicted)**의 분포를 비교하는 시각화입니다.

---

## ✔ 공통적으로 발견되는 핵심 패턴

### 🔹 2-1. 저수요 구간(0~150) 예측은 비교적 우수  
- 모든 모델이 낮은 대여량(특히 0~100 사이)을 꽤 정확하게 맞춥니다.  
- 데이터의 대부분이 이 구간에 몰려 있기 때문에 학습이 잘 이뤄진 결과입니다.

➡ **Baseline 수요 예측은 잘됨**

---

### 🔹 2-2. 고수요 구간(200~800) 예측력이 매우 낮음  
- 특히 서울 데이터에서 심각함  
- 실제값이 300~800 사이로 뛰어도 모델 예측은 대부분 150~250 근처로 몰립니다.  
- 세 모델 모두 공통적으로 “수요 폭발(Peak Surge)” 현상을 따라가지 못함

➡ **고수요 예측 실패 = Underfitting + 데이터 불균형 영향**

---

### 🔹 2-3. 예측 값이 평균 근처로 몰리는 편향(Bias)  
- 산점도에서 대각선(이상적 예측)을 기준으로 분포가 한쪽에 치우침  
- 특히 RF는 가장 심하고, LGBM이 그나마 가장 낫지만 여전히 부족

➡ **고값 예측을 학습하지 못하고 ‘평균적 값’으로 수렴하는 경향이 강함**

---

# ⏱ 3. 시계열(Line Plot) 분석

시계열 그래프는 **시간 흐름에 따른 실제값 vs 예측값 비교**입니다.

---

### 🔹 3-1. Actual은 크게 출렁이지만 Pred는 거의 평평  
- 실제 대여량은 하루 중 시간대와 요일에 따라 급격하게 변동  
- 반면 모델 예측은 변동 폭이 매우 작음

➡ **특정 시간대(출퇴근 등)의 구조적 패턴을 학습하지 못함**

---

### 🔹 3-2. 세 모델 예측곡선이 거의 겹쳐 보임  
이는 두 가지 사실을 의미함:

1. **모델들이 모두 비슷한 패턴으로 underfit되고 있다**  
2. 실제 값(파란색)에 비해 모델 예측값의 변화량이 너무 작다  

➡ **현재 피처 구성만으로는 시계열 변동을 충분히 표현할 수 없음**

---

# 🧪 4. 모델별 성능 요약

### ⭐ RandomForest
- Underfitting이 가장 심함  
- 대부분의 예측값이 100~200 수준에 몰림  
- 고수요 구간 완전 실패  

➡ 고난도 회귀 문제에 RF는 잘 맞지 않음

---

### ⭐ XGBoost
- RF보다 조금 나음  
- 그래도 여전히 고수요 예측 어려움  
- Low-range 예측 안정성은 우수  

➡ Feature interaction을 어느 정도 학습하지만 여전히 한계 존재

---

### ⭐ LightGBM
- **세 모델 중 가장 고수요를 잘 따라감**  
- 그러나 여전히 실제값 대비 큰 차이가 존재  
- 전반적인 분포가 가장 안정적인 편  

➡ 성능 1위지만, 개선 여지는 매우 큼

---

# 🔍 5. 문제의 근본 원인 분석

## 🟥 5-1. 데이터 불균형  
대여량 분포가 심하게 ‘치우쳐져’있음  
- 0~150: 데이터의 대부분  
- 200 이상: 극히 적은 비율

모든 모델은 RMSE 최소화를 위해 **평균 근처로 예측하려고 함**  
→ 고수요 못 맞추는 구조적 문제 발생

---

## 🟥 5-2. 고수요를 설명하는 피처 부족  
현재 피처는 다음과 같음:
- 시간(month/weekend/quarter_flag)
- POI (거리/개수)
- 기상 데이터(weather)

하지만 실제 수요 폭발의 주요 요인은 다음이 포함됨:

| 고수요 요인 | 현재 피처에 존재? |
|-------------|-------------------|
| 시간대(hour) | ❌ 없음 |
| 요일(day_of_week) | ❌ 없음 |
| 휴일 여부(holiday) | ❌ 없음 |
| 전 시간대 대여량(lag features) | ❌ 없음 |
| 이동 평균(rolling features) | ❌ 없음 |

➡ 고수요는 피처 부족으로 ***모델이 설명할 수 없는 부분이다***

---

## 🟥 5-3. 시계열 특성 반영 부족  
현재 모델은 완전한 **tabular regression** 모델 → 시간 의존성 없음  
따라서 peak 불연속성 학습이 매우 어려움

---

## 🟥 5-4. noise + 극단값 영향  
자전거 대여 데이터는 갑작스러운 spike가 많음  
모델은 이 값을 outlier로 인식하고 잘 따라가지 못함

---

# 🧭 6. 개선 방향 (Must-Do)

### ✅ 1) 강력한 시간 피처 추가 (가장 효과 큼)
- hour (0~23)  
- day_of_week  
- is_holiday  
- rush_hour_flag  
- season  

➡ 이거 넣으면 정확도 30~60% 개선 가능

---

### ✅ 2) 시계열 피처 추가
- lag1, lag2, lag24  
- rolling_mean(3h), rolling_mean(6h)  

➡ 갑작스러운 폭증 예측할 수 있는 기반이 됨

---

### ✅ 3) 수요 분포 조정 (Oversampling)
고수요 데이터만 oversample하여 분포 균형 맞추기  
또는 sample_weight 사용

---

### ✅ 4) 모델 교체 또는 앙상블
- CatBoost  
- Temporal Fusion Transformer(TFT)  
- XGB + LSTM hybrid  
- DeepAR  

---

# 🧾 7. 결론 — 한눈에 요약

> **현재 모델들은 평균적인 대여량 예측은 잘하지만,  
> 고수요 구간을 거의 예측하지 못하는 Underfitting 상태이다.  
> 이는 피처 부족 + 시간 의존성 부족 + 불균형 분포가 원인이다.  
> 시간·시계열 기반 피처 추가가 성능 향상의 핵심이다.**

---

